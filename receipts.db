git checkout -b sqlite-demo

# create db helper + schema files
mkdir -p app_db
cat > app_db/schema.sql <<'SQL'
-- one row per item (spreadsheet-friendly)
CREATE TABLE IF NOT EXISTS receipt_items (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  merchant TEXT NOT NULL,
  payment_id TEXT NOT NULL,
  order_id TEXT,
  item_name TEXT,
  sku TEXT,
  quantity REAL,
  unit_price REAL,
  receipt_total REAL,
  ts INTEGER
);

CREATE INDEX IF NOT EXISTS idx_receipt_items_user_ts ON receipt_items(user_id, ts DESC);
CREATE INDEX IF NOT EXISTS idx_receipt_items_payment ON receipt_items(payment_id);
SQL

cat > app_db/db.py <<'PY'
import os
import sqlite3

DB_PATH = os.getenv("RECEIPTS_DB_PATH", "receipts.db")

def get_conn() -> sqlite3.Connection:
    conn = sqlite3.connect(DB_PATH, check_same_thread=False)
    conn.row_factory = sqlite3.Row
    return conn

def init_db() -> None:
    from pathlib import Path
    schema_path = Path(__file__).with_name("schema.sql")
    schema = schema_path.read_text(encoding="utf-8")
    conn = get_conn()
    try:
        conn.executescript(schema)
        conn.commit()
    finally:
        conn.close()
PY

git add app_db/schema.sql app_db/db.py
git commit -m "Add SQLite schema + db helper for receipt_items"
